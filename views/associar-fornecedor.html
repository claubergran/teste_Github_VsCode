<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Associação de Fornecedor a Produto</title>
</head>

<body>
    <h1>Associação de Fornecedor a Produto</h1>
    <a href="/">Voltar</a>

    <!-- Detalhes do Produto -->
    <h2>Detalhes do Produto</h2>
    <form id="produtoForm">
        <label>Nome do Produto:</label><br>
        <input type="text" id="nomeProduto" readonly><br><br>

        <label>Código de Barras:</label><br>
        <input type="text" id="codigoBarras" readonly><br><br>

        <label>Descrição:</label><br>
        <textarea id="descricaoProduto" readonly></textarea><br><br>

        <label>Imagem do Produto:</label><br>
        <img id="imagemProduto" src="" alt="Imagem do Produto" width="150"><br><br>
    </form>

    <!-- Associação de Fornecedor -->
    <h2>Associar Fornecedor</h2>
    <form id="associarForm" method="POST">
        <label>Selecione um Fornecedor:</label><br>
        <select name="fornecedorCnpj" id="fornecedorCnpj" required>
            <option value="">Selecione um fornecedor</option>
        </select><br><br>

        <button type="submit">Associar Fornecedor</button>
    </form>

    <!-- Fornecedores Associados -->
    <h2>Fornecedores Associados</h2>
    <table border="1" id="fornecedoresAssociados">
        <thead>
            <tr>
                <th>Nome do Fornecedor</th>
                <th>CNPJ</th>
                <th>Ação</th>
            </tr>
        </thead>
        <tbody>
            <!-- As associações serão carregadas aqui -->
        </tbody>
    </table>

    <script>
        // Simular dados carregados do servidor
        // No futuro você pode substituir por API via fetch
        const produto = JSON.parse(localStorage.getItem('produtoSelecionado') || '{}');
        const fornecedores = JSON.parse(localStorage.getItem('fornecedores') || '[]');
        const associacoes = JSON.parse(localStorage.getItem('associacoes') || '[]');

        // Preencher detalhes do produto
        document.getElementById('nomeProduto').value = produto.nome || '';
        document.getElementById('codigoBarras').value = produto.codigoBarras || '';
        document.getElementById('descricaoProduto').value = produto.descricao || '';
        if (produto.imagem) {
            document.getElementById('imagemProduto').src = '/uploads/' + produto.imagem;
        }

        // Preencher dropdown de fornecedores
        const selectFornecedor = document.getElementById('fornecedorCnpj');
        fornecedores.forEach(f => {
            const option = document.createElement('option');
            option.value = f.cnpj;
            option.text = f.nome;
            selectFornecedor.appendChild(option);
        });

        // Exibir fornecedores associados
        function carregarFornecedoresAssociados() {
            const tbody = document.querySelector('#fornecedoresAssociados tbody');
            tbody.innerHTML = '';
            associacoes.filter(a => a.produtoCodigoBarras === produto.codigoBarras)
                .forEach(a => {
                    const fornecedor = fornecedores.find(f => f.cnpj === a.fornecedorCnpj);
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${fornecedor.nome}</td>
                        <td>${fornecedor.cnpj}</td>
                        <td>
                            <form method="POST" action="/produtos/${produto.codigoBarras}/desassociar">
                                <input type="hidden" name="fornecedorCnpj" value="${fornecedor.cnpj}">
                                <button type="submit">Desassociar</button>
                            </form>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
        }

        carregarFornecedoresAssociados();

        // Configurar formulário de associação
        const associarForm = document.getElementById('associarForm');
        associarForm.action = `/produtos/${produto.codigoBarras}/associar`;

    </script>
</body>

</html>